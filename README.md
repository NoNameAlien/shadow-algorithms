
# Shadow Algorithms Lab (WebGPU)

<!-- ![Project Preview](docs/images/preview.png) -->

Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°Ñ Ð²ÐµÐ±-Ð»Ð°Ð±Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð¸Ñ Ð´Ð»Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¸ ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ñ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ð¾Ð² Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ Ñ‚ÐµÐ½ÐµÐ¹ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ (WebGPU + TypeScript + React).

Ð¦ÐµÐ»ÑŒ â€” Ð¿Ð¾ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ð¾Ð´Ð½Ð¾ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ‡Ð½ÑƒÑŽ Ð²ÐµÐ±â€‘Ð»Ð°Ð±Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð¸ÑŽ (â€œÐºÐ°Ð»ÑŒÐºÑƒÐ»ÑÑ‚Ð¾Ñ€ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²â€), ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÐµÑ‚ Ð¸ ÑÑ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ñ‹ Ñ‚ÐµÐ½ÐµÐ¹: Shadow Mapping, PCF, PCSS, VSM/EVSM, Ð° Ñ‚Ð°ÐºÐ¶Ðµ, Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸, Cascaded Shadow Maps (CSM). ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ðµ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸, Ð½Ð°Ð±Ð¾Ñ€ Ñ‚ÐµÑÑ‚â€‘ÑÑ†ÐµÐ½, ÑÐ±Ð¾Ñ€ Ð¼ÐµÑ‚Ñ€Ð¸Ðº ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°/Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð¸ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð¾Ð².

---

## ðŸ› ï¸ Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑÑ‚ÐµÐº

### Frontend
- **React 18** â€” UI ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹
- **TypeScript 5.2** â€” Ñ‚Ð¸Ð¿Ð¾Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ
- **Vite** â€” Ð±Ñ‹ÑÑ‚Ñ€Ð°Ñ ÑÐ±Ð¾Ñ€ÐºÐ° Ð¸ HMR

### Graphics
- **WebGPU** â€” ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ GPU API
- **WGSL** â€” ÑˆÐµÐ¹Ð´ÐµÑ€Ð½Ñ‹Ð¹ ÑÐ·Ñ‹Ðº
- **gl-matrix** â€” Ð»Ð¸Ð½ÐµÐ¹Ð½Ð°Ñ Ð°Ð»Ð³ÐµÐ±Ñ€Ð°

---

## âœ¨ Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾

- âœ… **4 Ð¼ÐµÑ‚Ð¾Ð´Ð° Ñ‚ÐµÐ½ÐµÐ¹** â€” Shadow Mapping, PCF, PCSS, Variance Shadow Maps
- âœ… **Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ðµ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ** â€” Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ñ‚ÐµÐ½ÐµÐ¹ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
- âœ… **Ð”Ð²Ð° Ñ€ÐµÐ¶Ð¸Ð¼Ð° ÐºÐ°Ð¼ÐµÑ€Ñ‹** â€” Orbit (Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð²Ð¾ÐºÑ€ÑƒÐ³ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°) Ð¸ FPS (ÑÐ²Ð¾Ð±Ð¾Ð´Ð½Ð¾Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ)
- âœ… **Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹** â€” Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° OBJ Ñ„Ð°Ð¹Ð»Ð¾Ð²
- âœ… **Grid Ñ Ñ‚ÐµÐ½ÑÐ¼Ð¸** â€” Ð¿Ñ€Ð¾Ñ†ÐµÐ´ÑƒÑ€Ð½Ð°Ñ ÑÐµÑ‚ÐºÐ°-Ð¿Ñ€Ð¸Ñ‘Ð¼Ð½Ð¸Ðº Ñ‚ÐµÐ½ÐµÐ¹
- âœ… **Ð’Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ²ÐµÑ‚Ð°** â€” Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰Ð°ÐµÐ¼Ð°Ñ ÑÑ„ÐµÑ€Ð° Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ° ÑÐ²ÐµÑ‚Ð°
- âœ… **60 FPS** â€” Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ€ÐµÐ½Ð´ÐµÑ€

---

## ðŸŽ® Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ

### Orbit Mode (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ)
- **Drag Ð¾Ð±ÑŠÐµÐºÑ‚** â€” Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°
- **Shift + Drag** â€” Ð¿ÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ ÑÐ²ÐµÑ‚Ð°
- **WASD/Ð¡Ñ‚Ñ€ÐµÐ»Ð¾Ñ‡ÐºÐ¸** â€” orbit ÐºÐ°Ð¼ÐµÑ€Ñ‹
- **ÐšÐ¾Ð»ÐµÑÐ¸ÐºÐ¾ Ð¼Ñ‹ÑˆÐ¸** â€” zoom
- **Ctrl + Click** â€” Ð²Ð¾Ð¹Ñ‚Ð¸ Ð² FPS Ñ€ÐµÐ¶Ð¸Ð¼

### FPS Mode
- **WASD** â€” Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ ÐºÐ°Ð¼ÐµÑ€Ñ‹
- **ÐœÑ‹ÑˆÑŒ** â€” Ð²Ð·Ð³Ð»ÑÐ´
- **ÐŸÑ€Ð¾Ð±ÐµÐ»** â€” Ð²Ð²ÐµÑ€Ñ…
- **Shift** â€” Ð²Ð½Ð¸Ð·
- **ESC** â€” Ð²Ñ‹Ð¹Ñ‚Ð¸ Ð² Orbit Ñ€ÐµÐ¶Ð¸Ð¼

---

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ
- Node.js 18+ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ 20+)
- Ð‘Ñ€Ð°ÑƒÐ·ÐµÑ€ Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ WebGPU (Chrome/Edge 113+)
- **Linux:** Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ñ„Ð»Ð°Ð³Ð¸ Ð² `chrome://flags`
  - `#enable-unsafe-webgpu` â†’ Enabled
  - `#enable-vulkan` â†’ Enabled
  - ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€

### Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
```bash
npm install
npm run dev
```
ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ http://localhost:5173

### Ð¡Ð±Ð¾Ñ€ÐºÐ°
```bash
npm run build
npm run preview
```

---

## ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ ControlPanel.tsx       # UI Ð¿Ð°Ð½ÐµÐ»ÑŒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ
â”œâ”€â”€ engine/
â”‚   â”œâ”€â”€ Renderer.ts            # ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ñ€ÐµÐ½Ð´ÐµÑ€ÐµÑ€
â”‚   â”œâ”€â”€ ArcballController.ts   # Ð’Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°
â”‚   â”œâ”€â”€ CameraController.ts    # Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ°Ð¼ÐµÑ€Ð¾Ð¹
â”‚   â””â”€â”€ LightDragger.ts        # ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ ÑÐ²ÐµÑ‚Ð°
â”œâ”€â”€ geometry/
â”‚   â””â”€â”€ SphereGenerator.ts     # Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÑÑ„ÐµÑ€Ñ‹
â”œâ”€â”€ gpu/
â”‚   â””â”€â”€ initWebGPU.ts          # Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ WebGPU
â”œâ”€â”€ loaders/
â”‚   â””â”€â”€ ModelLoader.ts         # OBJ Ð¿Ð°Ñ€ÑÐµÑ€
â”œâ”€â”€ shaders/                   # WGSL ÑˆÐµÐ¹Ð´ÐµÑ€Ñ‹
â”‚   â”œâ”€â”€ basic.wgsl             # Shadow Mapping
â”‚   â”œâ”€â”€ pcf.wgsl               # PCF
â”‚   â”œâ”€â”€ pcss.wgsl              # PCSS
â”‚   â”œâ”€â”€ vsm.wgsl               # VSM
â”‚   â”œâ”€â”€ depth.wgsl             # Shadow pass
â”‚   â”œâ”€â”€ grid_solid.wgsl        # Grid Ñ Ñ‚ÐµÐ½ÑÐ¼Ð¸
â”‚   â””â”€â”€ light_sphere.wgsl      # Ð’Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÐ²ÐµÑ‚Ð°
â””â”€â”€ utils/
    â””â”€â”€ poissonDisk.ts         # Poisson disk sampling
```

---

## ðŸ”¬ Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹

### 1. Shadow Mapping (SM)
ÐšÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ â€” Ð¶Ñ‘ÑÑ‚ÐºÐ¸Ðµ Ñ‚ÐµÐ½Ð¸ Ñ Ñ‡Ñ‘Ñ‚ÐºÐ¸Ð¼Ð¸ ÐºÑ€Ð°ÑÐ¼Ð¸.
- âš¡ Ð¡Ð°Ð¼Ñ‹Ð¹ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹
- âš ï¸ ÐÐ»Ð¸Ð°ÑÐ¸Ð½Ð³ Ð½Ð° ÐºÑ€Ð°ÑÑ…

### 2. Percentage Closer Filtering (PCF)
Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ â€” Ð¼ÑÐ³ÐºÐ¸Ðµ ÐºÑ€Ð°Ñ Ñ‡ÐµÑ€ÐµÐ· ÑƒÑÑ€ÐµÐ´Ð½ÐµÐ½Ð¸Ðµ ÑÐ¾ÑÐµÐ´Ð½Ð¸Ñ… texel.
- âœ¨ Ð¡Ð³Ð»Ð°Ð¶ÐµÐ½Ð½Ñ‹Ðµ ÐºÑ€Ð°Ñ
- ðŸŽ¯ ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€Ð°Ð´Ð¸ÑƒÑ

### 3. Percentage Closer Soft Shadows (PCSS)
Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¼ÑÐ³ÐºÐ¸Ðµ Ñ‚ÐµÐ½Ð¸ â€” Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð¿Ð¾Ð»ÑƒÑ‚ÐµÐ½Ð¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ñ.
- ðŸŒŸ Ð ÐµÐ°Ð»Ð¸ÑÑ‚Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¼ÑÐ³ÐºÐ¸Ðµ Ñ‚ÐµÐ½Ð¸
- ðŸ“ ÐŸÐµÐ½ÑƒÐ¼Ð±Ñ€Ð° Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ Ñ Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸ÐµÐ¼

### 4. Variance Shadow Maps (VSM)
ÐŸÑ€ÐµÐ´Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÐ½Ð¸ â€” Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð¾Ð² Ð³Ð»ÑƒÐ±Ð¸Ð½Ñ‹.
- ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ (compute shader)
- âš ï¸ Light bleeding Ð½Ð° Ñ‚Ð¾Ð½ÐºÐ¸Ñ… Ð¾Ð±ÑŠÐµÐºÑ‚Ð°Ñ…

---

## ðŸ› ï¸ Ð”Ð¾Ñ€Ð¾Ð¶Ð½Ð°Ñ ÐºÐ°Ñ€Ñ‚Ð°

### Ð“Ð¾Ñ‚Ð¾Ð²Ð¾ âœ…
- [x] Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ñ€ÐµÐ½Ð´ÐµÑ€ (ÐºÑƒÐ±, Lambert Ð¾ÑÐ²ÐµÑ‰ÐµÐ½Ð¸Ðµ)
- [x] Shadow Mapping
- [x] PCF Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ
- [x] PCSS Ð¼ÑÐ³ÐºÐ¸Ðµ Ñ‚ÐµÐ½Ð¸
- [x] VSM/compute blur
- [x] Ð”Ð²Ð° Ñ€ÐµÐ¶Ð¸Ð¼Ð° ÐºÐ°Ð¼ÐµÑ€Ñ‹ (orbit/FPS)
- [x] Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° OBJ Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹
- [x] ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰Ð°ÐµÐ¼Ñ‹Ð¹ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº ÑÐ²ÐµÑ‚Ð°

### Ð’ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ ðŸš§
- [ ] ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ (FPS timeline, frame time)
- [ ] Ð’Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Shadow Map (debug mode)
- [ ] Preset ÑÑ†ÐµÐ½Ñ‹ (Forest, Stairs, Multiple Objects)
- [ ] Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð¾Ð² (PDF, CSV, ÑÐºÑ€Ð¸Ð½ÑˆÐ¾Ñ‚Ñ‹)
- [ ] Cascaded Shadow Maps (CSM)

---

## ðŸ› Ð§Ð°ÑÑ‚Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹

**âŒ "Failed to request GPU adapter"**
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ `chrome://gpu` (WebGPU Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Hardware accelerated)
- Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ñ„Ð»Ð°Ð³Ð¸ WebGPU/Vulkan
- ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð´Ñ€Ð°Ð¹Ð²ÐµÑ€Ñ‹ GPU

**âŒ ÐÐ¸Ð·ÐºÐ¸Ð¹ FPS**
- Ð£Ð¼ÐµÐ½ÑŒÑˆÐ¸Ñ‚Ðµ Shadow Map Size Ð´Ð¾ 1024
- Ð£Ð¼ÐµÐ½ÑŒÑˆÐ¸Ñ‚Ðµ PCF Samples Ð´Ð¾ 8

**âŒ OBJ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð±ÐµÐ· Ñ‚ÐµÐ½ÐµÐ¹**
- Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ Ñ‡Ñ‚Ð¾ Ñƒ Ð¼Ð¾Ð´ÐµÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð½Ð¾Ñ€Ð¼Ð°Ð»Ð¸ (`vn` Ð² Ñ„Ð°Ð¹Ð»Ðµ)
- ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð½Ð°Ð´ Ð¿Ð»Ð¾ÑÐºÐ¾ÑÑ‚ÑŒÑŽ (Y > -2.5)
