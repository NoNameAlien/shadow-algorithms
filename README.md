# Shadow Algorithms Lab (WebGPU)

Веб-лаборатория для реализации и сравнения алгоритмов построения теней в реальном времени (WebGPU + TypeScript + React).

#### Кратко: что уже сделано
- Создан проект на базе Vite + React + TypeScript.
- Подключены типы WebGPU и библиотека линейной алгебры gl-matrix.
- Реализована инициализация WebGPU, depth‑буфер, базовый рендер‑пайплайн.
- Отрисовывается и плавно вращается 3D‑куб с ламбертовым освещением.

---

#### Описание проекта
Цель — построить одностраничную веб‑лабораторию (“калькулятор параметров”), которая реализует и сравнивает популярные алгоритмы теней: Shadow Mapping, PCF, PCSS, VSM/EVSM, а также, по времени, Cascaded Shadow Maps (CSM). Проект будет включать интерактивное управление параметрами, набор тест‑сцен, сбор метрик качества/производительности и экспорт отчётов.

Ключевые идеи:
- Вся работа — в браузере (WebGPU). Никакого серверного бэкенда.
- “Научная” часть: численный анализ ошибок (light bleeding, acne, aliasing), устойчивости и временной стабильности (shimmering).
- Портфолио‑ценность: современный стек (WebGPU, Rust→Wasm для эталона, React/TS), аккуратная архитектура и автотесты.

---

#### Стек
- UI/приложение: TypeScript, React, Vite
- Графика/compute: WebGPU (WGSL)
- Линалг: gl-matrix
- Типы WebGPU: @webgpu/types
- Дальше по плану: Rust → WebAssembly (эталонный трассер теней и метрики), Plotly/ECharts для графиков, Playwright/Vitest для тестов

---

#### Быстрый старт
1) Требования:
- Node.js 18+ (рекомендуется 20+)
- Браузер с поддержкой WebGPU (Chrome/Edge 113+). На Linux при необходимости включите флаги:
  - chrome://flags/#enable-unsafe-webgpu → Enabled
  - chrome://flags/#enable-vulkan → Enabled
  - перезапустите браузер

2) Установка и запуск:
```bash
npm i
npm run dev
```
Откройте http://localhost:5173 — вы увидите вращающийся куб.

3) Сборка:
```bash
npm run build
npm run preview
```

4) Частые проблемы:
- “Не удалось получить GPU‑адаптер”: проверьте chrome://gpu (WebGPU должен быть Hardware accelerated), включите флаги (см. выше), перезапустите браузер.

---

#### Структура проекта
```
.
├── public/
├── src/
│   ├── engine/
│   │   └── Renderer.ts           # пайплайн, буферы, цикл рендера
│   ├── gpu/
│   │   └── initWebGPU.ts         # инициализация WebGPU/контекста
│   ├── shaders/
│   │   └── basic.wgsl            # базовые шейдеры (Lambert)
│   ├── App.tsx
│   └── main.tsx
├── index.html
├── package.json
├── tsconfig.json
└── vite.config.ts
```

---

#### Планы по разработке (дорожная карта)
- Этап 1 — базовый рендер (готово)
  - Инициализация WebGPU, depth‑буфер, вращающийся куб, Lambert.
- Этап 2 — Shadow Mapping (жёсткие тени)
  - Depth pass из пространства источника, sampler_comparison, корректный bias (в т.ч. slope‑scaled).
- Этап 3 — Фильтрация PCF
  - Poisson‑disk ядра, параметры: радиус/число сэмплов; сравнение скорости и качества.
- Этап 4 — Мягкие тени PCSS
  - Поиск блокеров, оценка радиуса полутени, фильтрация; снижение шума (стохастика/temporal).
- Этап 5 — VSM/EVSM
  - Моменты глубины, mip‑предфильтрация, клампинг; снижение light bleeding; сравнение с PCF/PCSS.
- Этап 6 — CSM (по времени)
  - 2–4 каскада, схемы сплитов, texel snapping; анализ shimmering.
- Этап 7 — Эталон и метрики
  - Rust→Wasm: BVH + теневой луч (ground truth), метрики: классификация ошибок, MSE/PSNR/SSIM, shimmering score.
- Этап 8 — Тест‑сцены и эксперименты
  - Набор сцен (плоскость+бокс, колонны, ступени, тонкие детали, одна high‑poly модель), сценарии движения камеры/света.
- Этап 9 — Отчёт и UX
  - Графики (Plotly/ECharts), экспорт CSV/PNG/PDF, пресеты параметров, стабилизация FPS/UI, автотесты (скриншоты/юниты).

---

#### Что будет включать итоговая работа
- Реализация нескольких алгоритмов построения теней: SM, PCF, PCSS, VSM/EVSM (+CSM при наличии времени)
- Интерактивный “калькулятор параметров” с визуализацией результатов
- Набор воспроизводимых тест‑сцен и сценариев движения камеры/света
- Подсистема метрик (качество/устойчивость/производительность) и сравнение с эталоном
- Экспорт отчётов (PDF/CSV/PNG) для включения в диплом
- Документация и результаты экспериментов

---

#### Скрипты npm
- `npm run dev` — запуск dev‑сервера (Vite)
- `npm run build` — прод‑сборка
- `npm run preview` — предпросмотр прод‑сборки
